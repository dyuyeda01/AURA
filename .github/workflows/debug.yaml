name: 🌞 AURA Debug Run (Manual Test)

on:
  workflow_dispatch:  # manual trigger only

permissions:
  contents: read

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: 🧩 Checkout repository
        uses: actions/checkout@v4

      - name: 🐍 Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: 📦 Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: 🔐 Load environment variables
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          NEWSAPI_KEY: ${{ secrets.NEWSAPI_KEY }}
          NVD_API_KEY: ${{ secrets.NVD_API_KEY }}
        run: |
          echo "✅ Environment variables loaded."
          if [ -z "$OPENAI_API_KEY" ]; then
            echo "⚠️ WARNING: OPENAI_API_KEY not found — summaries will be skipped."
          fi

      - name: 🧠 Run AURA update (no commit)
        env:
          PYTHONPATH: "${{ github.workspace }}"
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          NEWSAPI_KEY: ${{ secrets.NEWSAPI_KEY }}
          NVD_API_KEY: ${{ secrets.NVD_API_KEY }}
        run: |
          echo "🧭 PYTHONPATH is: $PYTHONPATH"
          echo "🚀 Running debug AURA update..."
          python scripts/aura_update.py
          echo "✅ AURA debug update completed."

      - name: 🕵️ Inspect output
        run: |
          echo "🔍 Checking public/data/aura_scores.json:"
          head -n 50 public/data/aura_scores.json || echo "⚠️ No output file generated."
