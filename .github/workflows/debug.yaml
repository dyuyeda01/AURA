name: ğŸŒ AURA Debug Run (Manual Test)

on:
  workflow_dispatch:  # manual trigger only

permissions:
  contents: read

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§© Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: ğŸ” Load environment variables
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          NEWSAPI_KEY: ${{ secrets.NEWSAPI_KEY }}
          NVD_API_KEY: ${{ secrets.NVD_API_KEY }}
        run: |
          echo "âœ… Environment variables loaded."
          if [ -z "$OPENAI_API_KEY" ]; then
            echo "âš ï¸ WARNING: OPENAI_API_KEY not found â€” summaries will be skipped."
          fi

      - name: ğŸ§  Run AURA update (no commit)
        env:
          PYTHONPATH: "${{ github.workspace }}"
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          NEWSAPI_KEY: ${{ secrets.NEWSAPI_KEY }}
          NVD_API_KEY: ${{ secrets.NVD_API_KEY }}
        run: |
          echo "ğŸ§­ PYTHONPATH is: $PYTHONPATH"
          echo "ğŸš€ Running debug AURA update..."
          python scripts/aura_update.py
          echo "âœ… AURA debug update completed."

      - name: ğŸ•µï¸ Inspect output
        run: |
          echo "ğŸ” Checking public/data/aura_scores.json:"
          head -n 50 public/data/aura_scores.json || echo "âš ï¸ No output file generated."
